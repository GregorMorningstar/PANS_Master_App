import{u as O,r as o,j as e,c as Z}from"./app-6VWvmULT.js";import{E as J}from"./EmployeeLayout-BheE5ocy.js";import{F as r,f as Y,a as G,b as Q,c as y,d as ee,e as se,g as te,h as _,i as ae}from"./index-DG9SYJJy.js";import{B as P}from"./app-sidebar-layout-DRLK_nj4.js";import{e as I}from"./echo-Donffnrc.js";import{C as re}from"./circle-alert-BlJn_FAT.js";/* empty css            */import"./app-logo-icon-DrFhGwKx.js";import"./index-BCaWy0DS.js";import"./index-C2gJ1Fua.js";import"./index-C4J_hXM0.js";const ne={annual:"Urlop wypoczynkowy",sick:"Urlop zdrowotny",unpaid:"Urlop bezpłatny",parental:"Urlop rodzicielski",compassionate:"Urlop okolicznościowy",on_demand:"Urlop na żądanie"},ie={pending:"#f59e0b",approved:"#10b981",rejected:"#ef4444",cancelled:"#6b7280"},oe={pending:"Oczekuje",approved:"Zaakceptowany",rejected:"Odrzucony",cancelled:"Anulowany"};function le({leave:s,userLeaves:l,currentUserRole:n="employee",currentUserId:x,moderatorId:m,initialMessages:p=[],...S}){const{props:h}=O(),c=x||h.auth?.user?.id,[N,f]=o.useState(!1),[j,E]=o.useState(""),[w,v]=o.useState(p),[g,k]=o.useState(!1),D=o.useRef(null),C=o.useCallback(()=>n==="employee"?m||1:s?.user?.id,[n,m,s?.user?.id]),A=o.useCallback(async()=>{const t=C();if(t)try{const a=await fetch(`/chat?other_user_id=${t}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(a.ok){const i=await a.json();i.chats&&v(i.chats)}}catch(a){console.error("Error loading messages:",a)}},[C]);if(o.useEffect(()=>{if(!N||!c)return;const t=I.private(`chat.${c}`).listen("MessageSent",a=>{v(i=>i.some(d=>d.id===a.chatMessage.id)?i:[...i,a.chatMessage])});return()=>{t.stopListening("MessageSent"),I.leaveChannel(`private-chat.${c}`)}},[N,c]),o.useEffect(()=>{D.current?.scrollIntoView({behavior:"smooth"})},[w]),!s)return e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(r,{icon:Y,size:"2x",className:"mb-4"}),e.jsx("p",{children:"Brak danych urlopu"})]})});const L=t=>new Date(t).toLocaleDateString("pl-PL"),R=(t,a)=>{const i=new Date(t),d=new Date(a),u=Math.abs(d.getTime()-i.getTime());return Math.ceil(u/(1e3*60*60*24))+1},$=()=>{console.log("Edit leave:",s.id)},X=()=>{console.log("Withdraw leave:",s.id)},q=()=>{console.log("Approve leave:",s.id)},B=()=>{console.log("Reject leave:",s.id)},W=()=>{console.log("Open chat with user:",s.user?.id),f(!0)},F=()=>{console.log("Open chat to moderator from user:",s.id),f(!0),A()},M=async()=>{if(!j.trim()||g)return;const t=C();if(!t){console.error("No chat partner ID available");return}k(!0);try{const a=document.querySelector('meta[name="csrf-token"]')?.content;if(!a){console.error("CSRF token not found"),k(!1);return}const i=window.Echo?.socketId?.()||"",d=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":a,"X-Socket-ID":i},credentials:"same-origin",body:JSON.stringify({other_user_id:t,message:j.trim()})});if(d.ok){const u=await d.json();v(b=>b.some(H=>H.id===u.id)?b:[...b,u]),E("")}else{const u=await d.json();console.error("Error sending message:",u)}}catch(a){console.error("Error sending message:",a)}finally{k(!1)}},K=t=>{t.key==="Enter"&&(t.preventDefault(),M())},U=t=>new Date(t).toLocaleTimeString("pl-PL",{hour:"2-digit",minute:"2-digit"}),V=()=>{console.log("Alert moderator from user:",s.id)},T=ie[s.status]||"#6b7280",z=R(s.start_date,s.end_date);return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-white bg-opacity-20 rounded-full p-3",children:e.jsx(r,{icon:G,size:"lg"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:s.user?.name||"Nieznany użytkownik"}),e.jsx("p",{className:"text-blue-200",children:s.user?.email||""})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[s.user?.barcode&&e.jsx("div",{className:"bg-white bg-opacity-20 rounded-lg p-3 border border-white border-opacity-30",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{icon:Q,className:"text-white text-sm"}),e.jsx("span",{className:"text-white text-xs font-medium uppercase tracking-wide",children:"ID Pracownika"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(P,{value:s.user.barcode,width:2,height:40,fontSize:0,background:"#f9fafb",lineColor:"#374151",margin:0,displayValue:!0})}),e.jsx("span",{className:"text-black text-xs font-mono font-semibold tracking-wider",children:s.user.barcode})]})}),(n==="moderator"||n==="admin")&&e.jsx("button",{onClick:W,className:"bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg p-3 transition duration-200 border border-white border-opacity-30",title:"Napisz do użytkownika",children:e.jsx(r,{icon:y,className:"text-white text-lg"})})]})]})}),s.barcode&&e.jsx("div",{className:"bg-gray-50 border-b border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-3",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(P,{value:s.barcode,width:2,height:60,fontSize:0,background:"#f9fafb",lineColor:"#374151",margin:0,displayValue:!1})}),e.jsx("span",{className:"text-lg font-mono font-semibold text-gray-800 tracking-wider",children:s.barcode})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:T}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Status"}),e.jsx("p",{className:"font-semibold",style:{color:T},children:oe[s.status]||s.status})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Typ urlopu"}),e.jsx("p",{className:"font-semibold text-gray-900",children:ne[s.type]||s.type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Data rozpoczęcia"}),e.jsx("p",{className:"font-semibold text-gray-900",children:L(s.start_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Data zakończenia"}),e.jsx("p",{className:"font-semibold text-gray-900",children:L(s.end_date)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:z}),e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:z===1?"dzień urlopu":(z<5,"dni urlopu")})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:"12"}),e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"dni pozostałych"})]})})]}),s.description&&e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium mb-2",children:"Opis/Uwagi"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsx("p",{className:"text-gray-800",children:s.description})})]})]}),e.jsx("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-3 justify-between",children:[n==="employee"&&e.jsxs("div",{className:"flex gap-3",children:[(s.status==="pending"||s.status==="rejected")&&e.jsxs("button",{onClick:$,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium",children:[e.jsx(r,{icon:ee}),e.jsx("span",{children:"Edytuj"})]}),s.status==="pending"&&e.jsxs("button",{onClick:X,className:"flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium",children:[e.jsx(r,{icon:se}),e.jsx("span",{children:"Wycofaj"})]}),e.jsxs("button",{onClick:F,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-purple-700 transition font-medium",title:"Napisz do moderatora",children:[e.jsx(r,{icon:y}),e.jsx("span",{children:"Chat"})]}),e.jsxs("button",{onClick:V,className:"flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-purple-700 transition font-medium",title:"Napisz do moderatora",children:[e.jsx(re,{}),e.jsx("span",{children:"Szybkie zgłoszenie"})]})]}),(n==="moderator"||n==="admin")&&s.status==="pending"&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:q,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium",children:[e.jsx(r,{icon:te}),e.jsx("span",{children:"Zaakceptuj"})]}),e.jsxs("button",{onClick:B,className:"flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium",children:[e.jsx(r,{icon:_}),e.jsx("span",{children:"Odrzuć"})]})]})]})})]}),N&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-end z-50 p-4",onClick:()=>f(!1),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full h-full max-h-[600px] mr-4",onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"bg-blue-600 p-4 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{icon:y,className:"text-white"}),e.jsx("span",{className:"text-white font-semibold",children:"Chat z moderatorem (ID: 2)"})]}),e.jsx("button",{onClick:()=>f(!1),className:"text-white hover:bg-blue-700 rounded-full p-2 transition",children:e.jsx(r,{icon:_})})]})}),e.jsxs("div",{className:"p-4 flex flex-col h-full",children:[e.jsx("div",{className:"flex-1 bg-gray-50 rounded-lg p-3 mb-4 overflow-y-auto min-h-[300px] max-h-[400px]",children:e.jsxs("div",{className:"space-y-3",children:[w.length===0?e.jsx("div",{className:"text-sm text-gray-500 text-center py-8",children:"Rozpocznij rozmowę z moderatorem"}):w.map(t=>e.jsx("div",{className:`flex ${t.sender_id===c?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs px-3 py-2 rounded-lg text-sm ${t.sender_id===c?"bg-blue-600 text-white":"bg-white border border-gray-200 text-gray-800"}`,children:[e.jsx("p",{children:t.message}),e.jsx("p",{className:`text-xs mt-1 ${t.sender_id===c?"text-blue-200":"text-gray-500"}`,children:U(t.created_at)})]})},t.id)),e.jsx("div",{ref:D})]})}),e.jsxs("div",{className:"flex space-x-2 mt-auto",children:[e.jsx("input",{type:"text",value:j,onChange:t=>E(t.target.value),onKeyPress:K,placeholder:"Napisz wiadomość...",disabled:g,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"}),e.jsx("button",{onClick:M,disabled:!j.trim()||g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(r,{icon:g?y:ae,className:g?"animate-pulse":""})})]})]})]})})]})}function ye(){const s=Z.c(7),{props:l}=O(),n=l?.leave??null;let x;s[0]!==l?.userLeaves?(x=l?.userLeaves??[],s[0]=l?.userLeaves,s[1]=x):x=s[1];const m=x;let p;s[2]===Symbol.for("react.memo_cache_sentinel")?(p=[{label:"Kalendarz",href:"/employee/calendar"},{label:"Szczegóły urlopu",href:"/employee/calendar/details-leaves"}],s[2]=p):p=s[2];const S=p;let h;return s[3]!==n||s[4]!==l||s[5]!==m?(h=e.jsx(J,{breadcrumbs:S,children:e.jsx(le,{leave:n,userLeaves:m,...l})}),s[3]=n,s[4]=l,s[5]=m,s[6]=h):h=s[6],h}export{ye as default};
