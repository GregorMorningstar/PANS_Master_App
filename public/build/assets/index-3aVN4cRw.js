import{c as Re,r as u,b as Ie,j as t,a as Ue,u as $e}from"./app-6VWvmULT.js";import{B as Ae}from"./app-sidebar-layout-DRLK_nj4.js";import{G as He}from"./glasses-mSj487L1.js";import{a as Oe}from"./app-logo-icon-DrFhGwKx.js";import{T as We}from"./trash-2-Cp2ifHGN.js";import{M as Ge}from"./ModeratorLayout-BuZ7YoP3.js";/* empty css            */import"./index-BCaWy0DS.js";import"./index-C2gJ1Fua.js";import"./index-C4J_hXM0.js";import"./index-DG9SYJJy.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],qe=Oe("Pen",Ze),_e=10,Je=(s,e=50)=>{if(!s)return"";const m=s.split(/\s+/);return m.length<=e?s:m.slice(0,e).join(" ")+"..."},Ke=s=>s?{breakdown:"Awaria",operational:"Sprawna",maintenance:"W serwisie",idle:"Nieaktywna"}[s.toLowerCase()]??s.charAt(0).toUpperCase()+s.slice(1):"-";function Qe(s){const e=Re.c(123),{allmachineFailures:m,auth:h}=s;let L;e[0]!==m?(L=m===void 0?[]:m,e[0]=m,e[1]=L):L=e[1];const g=L;let P;e[2]!==h?(P=h===void 0?{}:h,e[2]=h,e[3]=P):P=e[3];const w=P;let d;e[4]!==w?.user?(d=w?.user??{},e[4]=w?.user,e[5]=d):d=e[5];const F=d,be=String(F?.role??"");let X;e[6]!==be?(X=be.toLowerCase(),e[6]=be,e[7]=X):X=e[7];const j=X,[ye,Ce]=u.useState(null),[a,Y]=u.useState(null),[k,ze]=u.useState(null),je=Ie(),[Ne,Me]=u.useState(g);let ee,te;e[8]!==g?(ee=()=>{Me(g)},te=[g],e[8]=g,e[9]=ee,e[10]=te):(ee=e[9],te=e[10]),u.useEffect(ee,te);const[i,Te]=u.useState(null),[S,De]=u.useState("desc");let se;e[11]!==i?(se=l=>{i===l?De(st):(Te(l),De("desc"))},e[11]=i,e[12]=se):se=e[12];const Q=se,Le=tt;let re;e[13]!==je||e[14]!==a?.id?(re=async l=>{confirm("Czy na pewno chcesz usunąć to zgłoszenie awarii?")&&(ze(l),je.delete(`/machines/failures/${l}`,{preserveState:!0,onSuccess:()=>{Me(n=>n.filter(o=>o.id!==l)),a?.id===l&&Y(null)},onFinish:()=>ze(null),onError:et}))},e[13]=je,e[14]=a?.id,e[15]=re):re=e[15];const B=re,[x,Fe]=u.useState(""),[f,Ee]=u.useState(""),[N,Pe]=u.useState(null),[v,Be]=u.useState(null),[p,ae]=u.useState(1);let le;if(e[16]!==N||e[17]!==v||e[18]!==f||e[19]!==x||e[20]!==Ne){let l;e[22]!==N||e[23]!==v||e[24]!==f||e[25]!==x?(l=n=>{if(x&&!n.machine?.name?.toLowerCase().includes(x.toLowerCase())||f&&!n.barcode?.toLowerCase().includes(f.toLowerCase()))return!1;if(N&&n.reported_at){const o=new Date(n.reported_at),c=new Date(N);if(c.setHours(0,0,0,0),o<c)return!1}if(v&&n.reported_at){const o=new Date(n.reported_at),c=new Date(v);if(c.setHours(23,59,59,999),o>c)return!1}return!0},e[22]=N,e[23]=v,e[24]=f,e[25]=x,e[26]=l):l=e[26],le=Ne.filter(l),e[16]=N,e[17]=v,e[18]=f,e[19]=x,e[20]=Ne,e[21]=le}else le=e[21];const b=le;let ne;e[27]===Symbol.for("react.memo_cache_sentinel")?(ne=()=>{ae(1)},e[27]=ne):ne=e[27];let oe;e[28]!==b?(oe=[b],e[28]=b,e[29]=oe):oe=e[29],u.useEffect(ne,oe);let V;if(e[30]!==b||e[31]!==i||e[32]!==S){e:{const l=[...b];if(!i){V=l;break e}let n;e[34]!==i||e[35]!==S?(n=(o,c)=>{const D=i==="failure_rank"?o.failure_rank??0:o[i]??"",y=i==="failure_rank"?c.failure_rank??0:c[i]??"";return D===y?0:S==="asc"?D>y?1:-1:D<y?1:-1},e[34]=i,e[35]=S,e[36]=n):n=e[36],l.sort(n),V=l}e[30]=b,e[31]=i,e[32]=S,e[33]=V}else V=e[33];const ve=V,_=Math.max(1,Math.ceil(b.length/_e));let E,A,C,z,R,T,M,I;if(e[37]!==p||e[38]!==N||e[39]!==v||e[40]!==k||e[41]!==f||e[42]!==x||e[43]!==B||e[44]!==ye||e[45]!==i||e[46]!==S||e[47]!==ve||e[48]!==Q||e[49]!==F?.id||e[50]!==j){E=ve.slice((p-1)*_e,p*_e);const l=Ye;T="space-y-4";let n;e[59]===Symbol.for("react.memo_cache_sentinel")?(n=t.jsx("button",{className:"px-3 py-1 text-sm border rounded",children:"All"}),e[59]=n):n=e[59];let o;e[60]!==j?(o=j==="moderator"&&t.jsx("button",{className:"px-3 py-1 text-sm border rounded",children:"Moderator Action"}),e[60]=j,e[61]=o):o=e[61];let c;e[62]!==o?(c=t.jsxs("div",{className:"flex gap-2",children:[n,o]}),e[62]=o,e[63]=c):c=e[63];let D;e[64]===Symbol.for("react.memo_cache_sentinel")?(D=r=>Fe(r.target.value),e[64]=D):D=e[64];let y;e[65]!==x?(y=t.jsx("input",{placeholder:"Nazwa maszyny",value:x,onChange:D,className:"px-3 py-2 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"}),e[65]=x,e[66]=y):y=e[66];let ce;e[67]===Symbol.for("react.memo_cache_sentinel")?(ce=r=>Ee(r.target.value),e[67]=ce):ce=e[67];let W;e[68]!==f?(W=t.jsx("input",{placeholder:"Barcode",value:f,onChange:ce,className:"px-3 py-2 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"}),e[68]=f,e[69]=W):W=e[69];const we=N??"";let de;e[70]===Symbol.for("react.memo_cache_sentinel")?(de=r=>Pe(r.target.value||null),e[70]=de):de=e[70];let G;e[71]!==we?(G=t.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-600",children:["Od",t.jsx("input",{type:"date",value:we,onChange:de,className:"px-2 py-1 text-xs border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e[71]=we,e[72]=G):G=e[72];const ke=v??"";let me;e[73]===Symbol.for("react.memo_cache_sentinel")?(me=r=>Be(r.target.value||null),e[73]=me):me=e[73];let Z;e[74]!==ke?(Z=t.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-600",children:["Do",t.jsx("input",{type:"date",value:ke,onChange:me,className:"px-2 py-1 text-xs border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e[74]=ke,e[75]=Z):Z=e[75];let ue;e[76]===Symbol.for("react.memo_cache_sentinel")?(ue=t.jsx("button",{onClick:()=>{Fe(""),Ee(""),Pe(null),Be(null)},className:"px-4 py-2 text-sm border rounded hover:bg-gray-50",children:"Wyczyść"}),e[76]=ue):ue=e[76];let q;e[77]!==y||e[78]!==W||e[79]!==G||e[80]!==Z?(q=t.jsxs("div",{className:"flex flex-wrap items-center gap-2 ml-auto",children:[y,W,G,Z,ue]}),e[77]=y,e[78]=W,e[79]=G,e[80]=Z,e[81]=q):q=e[81],e[82]!==c||e[83]!==q?(M=t.jsx("div",{children:t.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[c,q]})}),e[82]=c,e[83]=q,e[84]=M):M=e[84],R="overflow-x-auto",A="w-full border-collapse",e[85]===Symbol.for("react.memo_cache_sentinel")?(C=t.jsxs("colgroup",{children:[t.jsx("col",{style:{width:"20%"}}),t.jsx("col",{style:{width:"40%"}}),t.jsx("col",{style:{width:"6%"}}),t.jsx("col",{style:{width:"15%"}}),t.jsx("col",{style:{width:"10%"}}),t.jsx("col",{style:{width:"9%"}})]}),e[85]=C):C=e[85];let xe,fe;e[86]===Symbol.for("react.memo_cache_sentinel")?(xe=t.jsx("th",{className:"p-3 text-left font-medium text-gray-900",children:"Nazwa"}),fe=t.jsx("th",{className:"p-3 text-left font-medium text-gray-900",children:"Opis"}),e[86]=xe,e[87]=fe):(xe=e[86],fe=e[87]);let J;e[88]!==Q?(J=()=>Q("failure_rank"),e[88]=Q,e[89]=J):J=e[89];const Se=i==="failure_rank"?S==="asc"?"▲":"▼":"";let K;e[90]!==J||e[91]!==Se?(K=t.jsxs("th",{className:"p-3 text-left font-medium text-gray-900 cursor-pointer select-none",onClick:J,title:"Sortuj po rankingu",children:["Ranking ",Se]}),e[90]=J,e[91]=Se,e[92]=K):K=e[92];let he,ge,pe;e[93]===Symbol.for("react.memo_cache_sentinel")?(he=t.jsx("th",{className:"p-3 text-left font-medium text-gray-900",children:"Barcode"}),ge=t.jsx("th",{className:"p-3 text-left font-medium text-gray-900",children:"Data awarii"}),pe=t.jsx("th",{className:"p-3 text-left font-medium text-gray-900",children:"Akcje"}),e[93]=he,e[94]=ge,e[95]=pe):(he=e[93],ge=e[94],pe=e[95]),e[96]!==K?(z=t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-50",children:[xe,fe,K,he,ge,pe]})}),e[96]=K,e[97]=z):z=e[97],I=t.jsx("tbody",{children:E.map(r=>t.jsxs("tr",{className:"border-t border-gray-200 hover:bg-gray-50",style:{backgroundColor:l(r)},children:[t.jsx("td",{className:"p-3 font-medium",children:r.machine?.name??"-"}),t.jsxs("td",{className:"p-3 relative max-w-xs",children:[t.jsx("div",{className:"truncate",title:r.failure_description,children:Je(r.failure_description,15)}),ye===r.id&&t.jsx("div",{className:"absolute left-0 top-full z-20 mt-1 p-3 bg-white border border-gray-200 rounded-lg shadow-lg max-w-sm whitespace-normal max-h-48 overflow-y-auto",children:r.failure_description})]}),t.jsx("td",{className:"p-3 text-sm font-medium text-gray-900",children:r.failure_rank??"-"}),t.jsx("td",{className:"p-3",children:r.barcode?t.jsx("div",{className:"w-32 h-8 flex items-center justify-center",children:t.jsx(Ae,{value:r.barcode,height:32,width:1.5})}):t.jsx("span",{className:"text-gray-400 text-sm",children:"-"})}),t.jsx("td",{className:"p-3 text-sm text-gray-900",children:r.reported_at??"-"}),t.jsx("td",{className:"p-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>Y(r),onMouseEnter:()=>Ce(r.id),onMouseLeave:()=>Ce(null),className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Szczegóły","aria-label":"Szczegóły",children:t.jsx(He,{className:"w-4 h-4"})}),(j==="moderator"||r.user_id===F?.id)&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>Le(r.id,r),className:"p-1.5 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Edytuj",children:t.jsx(qe,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>B(r.id),disabled:k===r.id,className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent rounded-lg transition-colors",title:"Usuń",children:k===r.id?t.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"}):t.jsx(We,{className:"w-4 h-4"})})]})]})})]},r.id))}),e[37]=p,e[38]=N,e[39]=v,e[40]=k,e[41]=f,e[42]=x,e[43]=B,e[44]=ye,e[45]=i,e[46]=S,e[47]=ve,e[48]=Q,e[49]=F?.id,e[50]=j,e[51]=E,e[52]=A,e[53]=C,e[54]=z,e[55]=R,e[56]=T,e[57]=M,e[58]=I}else E=e[51],A=e[52],C=e[53],z=e[54],R=e[55],T=e[56],M=e[57],I=e[58];let U;e[98]!==A||e[99]!==C||e[100]!==z||e[101]!==I?(U=t.jsxs("table",{className:A,children:[C,z,I]}),e[98]=A,e[99]=C,e[100]=z,e[101]=I,e[102]=U):U=e[102];let $;e[103]!==R||e[104]!==U?($=t.jsx("div",{className:R,children:U}),e[103]=R,e[104]=U,e[105]=$):$=e[105];let H;e[106]!==p||e[107]!==E||e[108]!==b.length||e[109]!==_?(H=_>1&&t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-white border-t border-gray-200 sm:px-6",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:["Pokazano ",E.length," z ",b.length," (",_," stron)"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>ae(Xe),disabled:p===1,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"« Poprzednia"}),Array.from({length:Math.min(5,_)},(l,n)=>{const o=Math.max(1,Math.min(_,p-2+n));return t.jsx("button",{onClick:()=>ae(o),className:`px-3 py-2 text-sm font-medium border rounded-md transition-colors ${o===p?"bg-blue-600 text-white border-blue-600 shadow-sm":"text-gray-700 bg-white border-gray-300 hover:bg-gray-50"}`,children:o},o)}),t.jsx("button",{onClick:()=>ae(l=>Math.min(_,l+1)),disabled:p===_,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Następna »"})]})]}),e[106]=p,e[107]=E,e[108]=b.length,e[109]=_,e[110]=H):H=e[110];let O;e[111]!==k||e[112]!==B||e[113]!==a||e[114]!==F?.id||e[115]!==j?(O=a&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:()=>Y(null),children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",onClick:Ve,children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-start justify-between gap-6",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:a.machine?.name??"Nazwa maszyny"}),t.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Stan:"})," ",Ke(a.machine?.status)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Ostatnia awaria:"})," ",a.machine?.last_failure_date??"-"]})]})]}),t.jsxs("div",{className:"flex-shrink-0 text-right min-w-[140px]",children:[a.machine?.barcode?t.jsx("div",{className:"mb-2",children:t.jsx(Ae,{value:a.machine.barcode,height:60})}):t.jsx("div",{className:"text-gray-500 text-sm",children:"Brak kodu"}),a.machine?.id&&t.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",a.machine.id]})]})]})}),t.jsxs("div",{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Szczegóły awarii"}),t.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[t.jsx("strong",{className:"block mb-2 text-sm font-medium text-gray-900",children:"Opis:"}),t.jsx("p",{className:"whitespace-pre-wrap text-gray-900 leading-relaxed",children:a.failure_description})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[t.jsxs("div",{children:[t.jsx("strong",{className:"text-sm font-medium text-gray-900",children:"Ranking:"}),t.jsx("div",{className:"mt-1 text-sm text-gray-900",children:a.failure_rank??"-"})]}),t.jsxs("div",{children:[t.jsx("strong",{className:"text-sm font-medium text-gray-900",children:"Zgłoszona:"}),t.jsx("div",{className:"mt-1 text-sm text-gray-900",children:a.reported_at??"-"})]}),t.jsxs("div",{children:[t.jsx("strong",{className:"text-sm font-medium text-gray-900",children:"Użytkownik:"}),t.jsxs("div",{className:"mt-1 flex items-center gap-2 text-sm text-blue-600 hover:text-blue-700 font-medium",children:[t.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[t.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),t.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),a.user?.name??`User #${a.user_id??"-"}`]})]})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:[(j==="moderator"||a.user_id===F?.id)&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>Le(a.id),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors",children:"Edytuj"}),t.jsx("button",{onClick:()=>B(a.id),disabled:k===a.id,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:k===a.id?"Usuwanie...":"Usuń"})]}),t.jsx("button",{onClick:()=>Y(null),className:"px-6 py-2 text-sm font-medium text-blue-600 bg-transparent border border-blue-600 rounded-lg hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:"Zamknij"})]})]})}),e[111]=k,e[112]=B,e[113]=a,e[114]=F?.id,e[115]=j,e[116]=O):O=e[116];let ie;return e[117]!==T||e[118]!==M||e[119]!==$||e[120]!==H||e[121]!==O?(ie=t.jsxs("div",{className:T,children:[M,$,H,O]}),e[117]=T,e[118]=M,e[119]=$,e[120]=H,e[121]=O,e[122]=ie):ie=e[122],ie}function Ve(s){return s.stopPropagation()}function Xe(s){return Math.max(1,s-1)}function Ye(s){if(!s.reported_at)return;const e=new Date(s.reported_at);if(isNaN(e.getTime()))return;const h=(new Date().getTime()-e.getTime())/864e5;if(h>3)return"#f6d7db";if(h>2)return"#ffd6d6";if(h>1)return"#fff4b0"}function et(){}function tt(s,e){Ue.visit(`/machines/failures/edit/${s}`,{data:e??{}})}function st(s){return s==="asc"?"desc":"asc"}function ft(){const s=Re.c(5),m=$e().props,h=m?.auth?.user?.role??"",L=String(h).toLowerCase();let g;s[0]===Symbol.for("react.memo_cache_sentinel")?(g=[{label:"Moderator",href:"/moderator"},{label:"Maszyny",href:"/moderator/machines"},{label:"Lista Awarii",href:"/moderator/machines/report-failure"}],s[0]=g):g=s[0];const P=g;if(L==="moderator"){let d;return s[1]!==m?(d=t.jsx(Ge,{breadcrumbs:P,title:"Lista Awarii",children:t.jsx(Qe,{...m})}),s[1]=m,s[2]=d):d=s[2],d}if(L==="employee"){let d;return s[3]===Symbol.for("react.memo_cache_sentinel")?(d=t.jsx("div",{children:"2"}),s[3]=d):d=s[3],d}let w;return s[4]===Symbol.for("react.memo_cache_sentinel")?(w=t.jsx("div",{}),s[4]=w):w=s[4],w}export{ft as default};
